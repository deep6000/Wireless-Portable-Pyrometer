
//#include<p18f65k90.h>
#include <htc.h>
#include <stdio.h>
#include "def.h"
#include "adc.h"
#include "temp.h"

//INT16U mV;
//INT16U Temperature;


const INT16U RType[ 1024] =
{	7232, 7244, 7256, 7268, 7280, 7292, 7304, 7316, 7328, 7340,
	7352, 7364, 7376, 7389, 7401, 7413, 7425, 7437, 7449, 7461,
	7473, 7485, 7498, 7510, 7522, 7534, 7546, 7558, 7570, 7583,
	7595, 7607, 7619, 7631, 7644, 7656, 7668, 7680, 7692, 7705,
	7717, 7729, 7741, 7753, 7766, 7778, 7790, 7802, 7815, 7827,
	
	7839, 7851, 7864, 7876, 7888, 7901, 7913, 7925, 7938, 7950,
	7962, 7974, 7987, 7999, 8011, 8024, 8036, 8048, 8061, 8073,
	8086, 8098, 8110, 8123, 8135, 8147, 8160, 8172, 8185, 8197,
	8209, 8222, 8234, 8247, 8259, 8272, 8284, 8296, 8309, 8321,
	8334, 8346, 8359, 8371, 8384, 8396, 8409, 8421, 8434, 8446,
	
	8459, 8471, 8484, 8496, 8509, 8521, 8534, 8546, 8559, 8571,
	8584, 8597, 8609, 8622, 8634, 8647, 8659, 8672, 8685, 8697,
	8710, 8722, 8735, 8748, 8760, 8773, 8785, 8798, 8811, 8823,
	8836, 8849, 8861, 8874, 8887, 8899, 8912, 8925, 8937, 8950,
	8963, 8975, 8988, 9001, 9014, 9026, 9039, 9052, 9065, 9077,
	
	9090, 9103, 9115, 9128, 9141, 9154, 9167, 9179, 9192, 9205,
	9218, 9230, 9243, 9256, 9269, 9282, 9294, 9307, 9320, 9333,
	9346, 9359, 9371, 9384, 9397, 9410, 9423, 9436, 9449, 9461,
	9474, 9487, 9500, 9513, 9526, 9539, 9552, 9565, 9578, 9590,
	9603, 9616, 9629, 9642, 9655, 9668, 9681, 9694, 9707, 9720,
	
	9733, 9746, 9759, 9772, 9785, 9798, 9811, 9824, 9837, 9850,
	9863, 9876, 9889, 9902, 9915, 9928, 9941, 9954, 9967, 9980,
	9993,  10006, 10019, 10032, 10046, 10059, 10072, 10085, 10098, 10111,
	10124, 10137, 10150, 10163, 10177, 10190, 10203, 10216, 10229, 10242,
	10255, 10268, 10282, 10295, 10308, 10321, 10334, 10347, 10361, 10374,
	
	10387, 10400, 10413, 10427, 10440, 10453, 10466, 10480, 10493, 10506,
	10519, 10532, 10546, 10559, 10572, 10585, 10599, 10612, 10625, 10638,
	10652, 10665, 10678, 10692, 10705, 10718, 10731, 10745, 10758, 10771,
	10785, 10798, 10811, 10825, 10838, 10851, 10865, 10878, 10891, 10905,
	10918, 10932, 10945, 10958, 10972, 10985, 10998, 11012, 11025, 11039,
	
	11052, 11065, 11079, 11092, 11106, 11119, 11132, 11146, 11159, 11173,
	11186, 11200, 11213, 11227, 11240, 11253, 11267, 11280, 11294, 11307,
	11321, 11334, 11348, 11361, 11375, 11388, 11402, 11415, 11429, 11442,
	11456, 11469, 11483, 11496, 11510, 11524, 11537, 11551, 11564, 11578,
	11591, 11605, 11618, 11632, 11646, 11659, 11673, 11686, 11700, 11714,
	
	11727, 11741, 11754, 11768, 11782, 11795, 11809, 11822, 11836, 11850,
	11863, 11877, 11891, 11904, 11918, 11931, 11945, 11959, 11972, 11986,
	12000, 12013, 12027, 12041, 12054, 12068, 12082, 12096, 12109, 12123,
	12137, 12150, 12164, 12178, 12191, 12205, 12219, 12233, 12246, 12260,
	12274, 12288, 12301, 12315, 12329, 12342, 12356, 12370, 12384, 12397,
	
	12411, 12425, 12439, 12453, 12466, 12480, 12494, 12508, 12521, 12535,
	12549, 12563, 12577, 12590, 12604, 12618, 12632, 12646, 12659, 12673,
	12687, 12701, 12715, 12729, 12742, 12756, 12770, 12784, 12798, 12812,
	12825, 12839, 12853, 12867, 12881, 12895, 12909, 12922, 12936, 12950,
	12964, 12978, 12992, 13006, 13019, 13033, 13047, 13061, 13075, 13089,
	
	13103, 13117, 13131, 13145, 13158, 13172, 13186, 13200, 13214, 13228,
	13242, 13256, 13270, 13284, 13298, 13311, 13325, 13339, 13353, 13367,
	13381, 13395, 13409, 13423, 13437, 13451, 13465, 13479, 13493, 13507,
	13521, 13535, 13549, 13563, 13577, 13590, 13604, 13618, 13632, 13646,
	13660, 13674, 13688, 13702, 13716, 13730, 13744, 13758, 13772, 13786,
	
	13800, 13814, 13828, 13842, 13856, 13870, 13884, 13898, 13912, 13926,
	13940, 13954, 13968, 13982, 13996, 14010, 14024, 14038, 14052, 14066,
	14081, 14095, 14109, 14123, 14137, 14151, 14165, 14179, 14193, 14207,
	14221, 14235, 14249, 14263, 14277, 14291, 14305, 14319, 14333, 14347,
	14361, 14375, 14390, 14404, 14418, 14432, 14446, 14460, 14474, 14488,
	
	14502, 14516, 14530, 14544, 14558, 14572, 14586, 14601, 14615, 14629,
	14643, 14657, 14671, 14685, 14699, 14713, 14727, 14741, 14755, 14770,
	14784, 14798, 14812, 14826, 14840, 14854, 14868, 14882, 14896, 14911,
	14925, 14939, 14953, 14967, 14981, 14995, 15009, 15023, 15037, 15052,
	15066, 15080, 15094, 15108, 15122, 15136, 15150, 15164, 15179, 15193,
	
	15207, 15221, 15235, 15249, 15263, 15277, 15291, 15306, 15320, 15334,
	15348, 15362, 15376, 15390, 15404, 15419, 15433, 15447, 15461, 15475,
	15489, 15503, 15517, 15531, 15546, 15560, 15574, 15588, 15602, 15616,
	15630, 15645, 15659, 15673, 15687, 15701, 15715, 15729, 15743, 15758,
	15772, 15786, 15800, 15814, 15828, 15842, 15856, 15871, 15885, 15899,
	
	15913, 15927, 15941, 15955, 15969, 15984, 15998, 16012, 16026, 16040,
	16054, 16068, 16082, 16097, 16111, 16125, 16139, 16153, 16167, 16181,
	16196, 16210, 16224, 16238, 16252, 16266, 16280, 16294, 16309, 16323,
	16337, 16351, 16365, 16379, 16393, 16407, 16422, 16436, 16450, 16464,
	16478, 16492, 16506, 16520, 16534, 16549, 16563, 16577, 16591, 16605,
	
	16619, 16633, 16647, 16662, 16676, 16690, 16704, 16718, 16732, 16746,
	16760, 16774, 16789, 16803, 16817, 16831, 16845, 16859, 16873, 16887,
	16901, 16915, 16930, 16944, 16958, 16972, 16986, 17000, 17014, 17028,
	17042, 17056, 17071, 17085, 17099, 17113, 17127, 17141, 17155, 17169,
	17183, 17197, 17211, 17225, 17240, 17254, 17268, 17282, 17296, 17310,
	
	17324, 17338, 17352, 17366, 17380, 17394, 17408, 17423, 17437, 17451,
	17465, 17479, 17493, 17507, 17521, 17535, 17549, 17563, 17577, 17591,
	17605, 17619, 17633, 17647, 17661, 17676, 17690, 17704, 17718, 17732,
	17746, 17760, 17774, 17788, 17802, 17816, 17830, 17844, 17858, 17872,
	17886, 17900, 17914, 17928, 17942, 17956, 17970, 17984, 17998, 18012,
	
	18026, 18040, 18054, 18068, 18082, 18096, 18110, 18124, 18138, 18152,
	18166, 18180, 18194, 18208, 18222, 18236, 18250, 18264, 18278, 18292,
	18306, 18320, 18334, 18348, 18362, 18376, 18390, 18404, 18417, 18431,
	18445, 18459, 18473, 18487, 18501, 18515, 18529, 18543, 18557, 18571,
	18585, 18599, 18613, 18627, 18640, 18654, 18668, 18682, 18696, 18710,
	
	18724, 18738, 18752, 18766, 18779, 18793, 18807, 18821, 18835, 18849,
	18863, 18877, 18891, 18904, 18918, 18932, 18946, 18960, 18974, 18988,
	19002, 19015, 19029, 19043, 19057, 19071, 19085, 19098, 19112, 19126,
	19140, 19154, 19168, 19181, 19195, 19209, 19223, 19237, 19250, 19264,
	19278, 19292, 19306, 19319, 19333, 19347, 19361, 19375, 19388, 19402,
	
	19416, 19430, 19444, 19457, 19471, 19485, 19499, 19512, 19526, 19540,
	19554, 19567, 19581, 19595, 19609, 19622, 19636, 19650, 19663, 19677,
	19691, 19705, 19718, 19732, 19746, 19759, 19773, 19787, 19800, 19814,
	19828, 19841, 19855, 19869, 19882, 19896, 19910, 19923, 19937, 19951,
	19964, 19978, 19992, 20005, 20019, 20032, 20046, 20060, 20073, 20087,
	
	20100, 20114, 20127, 20141, 20154, 20168, 20181, 20195, 20208, 20222,
	20235, 20249, 20262, 20275, 20289, 20302, 20316, 20329, 20342, 20356,
	20369, 20382, 20396, 20409, 20422, 20436, 20449, 20462, 20475, 20488,
	20502, 20515, 20528, 20541, 20554, 20567, 20581, 20594, 20607, 20620,
	20633, 20646, 20659, 20672, 20685, 20698, 20711, 20724, 20736, 20749,
	
	20762, 20775, 20788, 20801, 20813, 20826, 20839, 20852, 20864, 20877,
	20890, 20902, 20915, 20928, 20940, 20953, 20965, 20978, 20990, 21003,
	21015, 21027, 21040, 21052
};


INT32S Scale(INT32S Value, INT32S Izero, INT32S Ispan, INT32S Ozero, INT32S Ospan)
{
	if(Ispan==Izero)
	return 0;
	return((INT32S)((INT32S)(Value-Izero)*(INT32S)(Ospan- Ozero))/(Ispan-Izero)+Ozero);
}

void Temp_Calc( void )
{

	INT16U mask = 0x0200, probe = 0x0200 ;
	mV= Scale (  AdcCount, ZCnt, SCnt,0,18840);

		
	//while(1)
	//{
		for(  ; mask != 0 ; )
		{
			if( mV < RType[ probe ] )
				probe &= ~mask ;
			
			mask >>= 1 ;	
			probe |= mask ;
		}
		
		Temperature = (INT16U)Scale( mV, RType[ probe], RType[ probe+1 ], probe, (probe+1)) ;
		Temperature += 740 ;
	//	Temperature = mV;
	}	





